<!doctype html><html lang=en-us dir=ltr><head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset=utf-8><meta name=viewport content="width=device-width"><link rel=icon type=image/ico href=http://localhost:1313/favicon//favicon.ico><link rel=icon type=image/png sizes=16x16 href=http://localhost:1313/favicon//favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=http://localhost:1313/favicon//favicon-32x32.png><link rel=icon type=image/png sizes=192x192 href=http://localhost:1313/favicon//android-chrome-192x192.png><link rel=apple-touch-icon sizes=180x180 href=http://localhost:1313/favicon//apple-touch-icon.png><meta name=description content><title>Object.assign() with accessor descriptor | My website
</title><link rel=canonical href=http://localhost:1313/section1/2019-03-08-object-assign-with-accessor-descriptor/><meta property="og:url" content="http://localhost:1313/section1/2019-03-08-object-assign-with-accessor-descriptor/"><meta property="og:site_name" content="My website"><meta property="og:title" content="Object.assign() with accessor descriptor"><meta property="og:description" content='MDN docs:
The Object.assign() method only copies enumerable and own properties from a source object to a target object. It uses [[Get]] on the source and [[Set]] on the target, so it will invoke getters and setters. Therefore it assigns properties versus just copying or defining new properties. This may make it unsuitable for merging new properties into a prototype if the merge sources contain getters.
For example
class Cat { constructor(name) { this._name = name; } get name() { return this._name; } set name(value) { this._name = value; } } let nyannko = new Cat("nyannko"); let copy = Object.assign({}, nyannko) console.log(nyannko.name) // nyannko console.log(copy.name) // undefined The name property is lost.'><meta property="og:locale" content="en_us"><meta property="og:type" content="article"><meta property="article:section" content="section1"><meta property="article:published_time" content="2019-03-08T09:00:00+00:00"><meta property="article:modified_time" content="2019-03-08T09:00:00+00:00"><meta property="article:tag" content="JavaScript"><link rel=stylesheet href=/assets/combined.min.8ab0250485e0710024f2b2624fe4610ef20516041156a21ddde0f0d76ae5ce66.css media=all></head><body class=auto><div class=content><header><div class=header><h1 class=header-title><a href=http://localhost:1313/ style=display:flex;align-items:center><img src=/favicon/apple-touch-icon.png alt=Icon height=40>
<span>Home Title</span></a></h1><div class="menu flex"><p class=menu-item><a href=http://localhost:1313/>/home</a></p><p class=menu-item><a href=http://localhost:1313/section1/>/Section1</a></p><p class=menu-item><a href=http://localhost:1313/section2/>/Section2</a></p><p class=menu-item><a href=http://localhost:1313/about>/about</a></p></div><hr></header><main class=main><div class=breadcrumbs><a href=/>Home</a>
<span class=breadcrumbs-separator>> </span><a href=/section1/>Section 1</a>
<span class=breadcrumbs-separator>> </span><a class=breadcrumbs-current href=/section1/2019-03-08-object-assign-with-accessor-descriptor/>Object.assign() with accessor descriptor</a></div><div class=autonumber><div class=single-intro-container><h1 class=single-title>Object.assign() with accessor descriptor</h1><p class=single-summary>Object.assign() with accessor descriptor</p><p class=single-readtime><time datetime=2019-03-08T09:00:00+00:00>Mar 8, 2019</time>
&nbsp; · &nbsp;
2 min read
&nbsp; · &nbsp;
<a href=/tags/javascript/><span style=color:red>#</span>JavaScript</a></p></div><aside class=toc><p><strong>Table of contents</strong></p><nav id=TableOfContents></nav></aside><div class=single-content><p><a href=https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/assign#Copying_accessors>MDN docs:</a></p><blockquote><p>The Object.assign() method only copies enumerable and own properties from a source object to a target object. It uses [[Get]] on the source and [[Set]] on the target, so it will invoke getters and setters. Therefore it assigns properties versus just copying or defining new properties. This may make it unsuitable for merging new properties into a prototype if the merge sources contain getters.</p></blockquote><p>For example</p><div class=highlight><pre tabindex=0 style=color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#ff6ac1>class</span> Cat {
</span></span><span style=display:flex><span>    constructor(name) {
</span></span><span style=display:flex><span>        <span style=color:#ff6ac1>this</span>._name <span style=color:#ff6ac1>=</span> name;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    get name() {
</span></span><span style=display:flex><span>        <span style=color:#ff6ac1>return</span> <span style=color:#ff6ac1>this</span>._name;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    set name(value) {
</span></span><span style=display:flex><span>        <span style=color:#ff6ac1>this</span>._name <span style=color:#ff6ac1>=</span> value;
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff5c57>let</span> nyannko <span style=color:#ff6ac1>=</span> <span style=color:#ff6ac1>new</span> Cat(<span style=color:#5af78e>&#34;nyannko&#34;</span>);
</span></span><span style=display:flex><span><span style=color:#ff5c57>let</span> copy <span style=color:#ff6ac1>=</span> <span style=color:#ff5c57>Object</span>.assign({}, nyannko)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>console.log(nyannko.name) <span style=color:#78787e>// nyannko
</span></span></span><span style=display:flex><span><span style=color:#78787e></span>console.log(copy.name) <span style=color:#78787e>// undefined
</span></span></span></code></pre></div><p>The <code>name</code> property is lost.</p><p>To copy accessors, we can use <code>Object.getOwnPropertyDescriptor()</code> and <code>Object.defineProperty()</code> as the MDN docs recommend:</p><div class=highlight><pre tabindex=0 style=color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#ff5c57>var</span> obj <span style=color:#ff6ac1>=</span> {
</span></span><span style=display:flex><span>  foo<span style=color:#ff6ac1>:</span> <span style=color:#ff9f43>1</span>,
</span></span><span style=display:flex><span>  get bar() {
</span></span><span style=display:flex><span>    <span style=color:#ff6ac1>return</span> <span style=color:#ff9f43>2</span>;
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>};
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff5c57>var</span> copy <span style=color:#ff6ac1>=</span> <span style=color:#ff5c57>Object</span>.assign({}, obj); 
</span></span><span style=display:flex><span>console.log(copy); 
</span></span><span style=display:flex><span><span style=color:#78787e>// { foo: 1, bar: 2 }, the value of copy.bar is obj.bar&#39;s getter&#39;s return value.
</span></span></span><span style=display:flex><span><span style=color:#78787e></span>
</span></span><span style=display:flex><span><span style=color:#78787e>// This is an assign function that copies full descriptors
</span></span></span><span style=display:flex><span><span style=color:#78787e></span><span style=color:#ff5c57>function</span> completeAssign(target, ...sources) {
</span></span><span style=display:flex><span>  sources.forEach(source =&gt; {
</span></span><span style=display:flex><span>    <span style=color:#ff5c57>let</span> descriptors <span style=color:#ff6ac1>=</span> <span style=color:#ff5c57>Object</span>.keys(source).reduce((descriptors, key) =&gt; {
</span></span><span style=display:flex><span>      descriptors[key] <span style=color:#ff6ac1>=</span> <span style=color:#ff5c57>Object</span>.getOwnPropertyDescriptor(source, key);
</span></span><span style=display:flex><span>      <span style=color:#ff6ac1>return</span> descriptors;
</span></span><span style=display:flex><span>    }, {});
</span></span><span style=display:flex><span>    <span style=color:#78787e>// by default, Object.assign copies enumerable Symbols too
</span></span></span><span style=display:flex><span><span style=color:#78787e></span>    <span style=color:#ff5c57>Object</span>.getOwnPropertySymbols(source).forEach(sym =&gt; {
</span></span><span style=display:flex><span>      <span style=color:#ff5c57>let</span> descriptor <span style=color:#ff6ac1>=</span> <span style=color:#ff5c57>Object</span>.getOwnPropertyDescriptor(source, sym);
</span></span><span style=display:flex><span>      <span style=color:#ff6ac1>if</span> (descriptor.enumerable) {
</span></span><span style=display:flex><span>        descriptors[sym] <span style=color:#ff6ac1>=</span> descriptor;
</span></span><span style=display:flex><span>      }
</span></span><span style=display:flex><span>    });
</span></span><span style=display:flex><span>    <span style=color:#ff5c57>Object</span>.defineProperties(target, descriptors);
</span></span><span style=display:flex><span>  });
</span></span><span style=display:flex><span>  <span style=color:#ff6ac1>return</span> target;
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ff5c57>var</span> copy <span style=color:#ff6ac1>=</span> completeAssign({}, obj);
</span></span><span style=display:flex><span>console.log(copy);
</span></span><span style=display:flex><span><span style=color:#78787e>// { foo:1, get bar() { return 2 } }
</span></span></span></code></pre></div><p>The other way is <code>Object.prototype.__proto__</code> (but <strong>not recommended</strong>):</p><div class=highlight><pre tabindex=0 style=color:#e2e4e5;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#ff5c57>let</span> completeCopy <span style=color:#ff6ac1>=</span> <span style=color:#ff5c57>Object</span>.assign({__proto__<span style=color:#ff6ac1>:</span> nyannko.__proto__}, nyannko);
</span></span><span style=display:flex><span>console.log(completeCopy.name); <span style=color:#78787e>// nyannko
</span></span></span></code></pre></div><p><code>Object.prototype.__proto__</code> is deprecated so be aware that this may cease to work at any time.
<a href=https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/proto>https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/proto</a></p></div><div class=single-pagination><hr><div class=flex><div class=single-pagination-prev><div class=single-pagination-container-prev><div class=single-pagination-text>←</div><div class=single-pagination-text><a href=/section1/2019-01-19-vue-navigation-guards/>VueのNavigation Guards</a></div></div></div><div class=single-pagination-next><div class=single-pagination-container-next><div class=single-pagination-text><a href=/section1/2019-03-08-es6-bind-trick/>Bind specific arguments of a function</a></div><div class=single-pagination-text>→</div></div></div></div><hr></div><div class=back-to-top><a href=#top>↑ Back to top</a></div></div></main></div><footer><div class=footer><p>© 2024 <a href=https://github.com/loyistro/Beige>loyistro/beige</a> theme</p></div></footer><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/katex.min.css><script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/katex.min.js></script><script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/contrib/auto-render.min.js onload=renderMathInElement(document.body)></script><script>document.addEventListener("DOMContentLoaded",function(){renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1}]})})</script></body><script>function isAuto(){return document.body.classList.contains("auto")}function setTheme(){if(!isAuto())return;document.body.classList.remove("auto");let e="light";window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches&&(e="dark"),document.body.classList.add(e)}function invertBody(){document.body.classList.toggle("dark"),document.body.classList.toggle("light")}isAuto()&&window.matchMedia("(prefers-color-scheme: dark)").addListener(invertBody),setTheme()</script></html>